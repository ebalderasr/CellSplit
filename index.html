<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CellSplit | Host Cell</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CellSplit">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="manifest" href="manifest.json">

    <style>
        /* --- VARIABLES DE DISEÑO --- */
        :root {
            --bg-main: #0a0a0a;
            --bg-card: #171717;
            --bg-input: #262626;
            --accent: #d4ff00; /* Verde Host Cell */
            --accent-glow: rgba(212, 255, 0, 0.2);
            --text-pri: #f5f5f5;
            --text-sec: #a3a3a3;
            --border-color: #333333;
            --live-color: #4caf50;
            --dead-color: #f44336;
            --danger: #ef5350;
        }

        /* --- ESTILOS GENERALES --- */
        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--bg-main);
            color: var(--text-pri);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            line-height: 1.4;
        }

        /* Clase para evitar confusión entre mL y ML */
        .u { font-family: Arial, sans-serif; text-transform: none !important; }

        /* --- ENCABEZADO --- */
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            max-width: 1000px;
            margin: 0 auto 25px auto;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
        }

        .header-title { color: var(--accent); text-transform: uppercase; font-size: 1.8rem; margin: 0; }
        .header-subtitle { font-size: 0.8rem; color: var(--text-sec); margin-top: 5px; }

        .controls { display: flex; flex-direction: column; gap: 10px; align-items: flex-end; }
        
        .lang-switch { font-weight: bold; color: var(--text-sec); cursor: pointer; }
        .lang-switch span.active { color: var(--accent); }

        /* Botones de control estándar */
        .btn-clear {
            background: transparent;
            color: var(--text-sec);
            border: 1px solid var(--text-sec);
            padding: 6px 12px;
            font-size: 0.8rem;
            cursor: pointer;
            text-transform: uppercase;
            font-family: inherit;
        }
        .btn-clear:hover { background: var(--danger); color: white; border-color: var(--danger); }

        /* Botón de Documentación (Resaltado) */
        .btn-docs {
            background: var(--bg-input);
            color: var(--accent);
            border: 1px solid var(--accent);
            padding: 8px 14px;
            font-size: 0.85rem;
            text-decoration: none;
            text-transform: uppercase;
            font-weight: bold;
            display: inline-block;
            transition: all 0.3s ease;
        }
        .btn-docs:hover { background: var(--accent); color: #000; }

        /* Botón de instalación con pulso */
        #install-btn {
            border-color: var(--accent);
            color: var(--accent);
            animation: pulse-green 2s infinite;
        }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(212, 255, 0, 0.4); }
            70% { box-shadow: 0 0 0 8px rgba(212, 255, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(212, 255, 0, 0); }
        }

        /* --- GRID Y TARJETAS --- */
        .app-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            max-width: 1000px;
            margin: 0 auto;
        }
        @media (min-width: 768px) { .app-grid { grid-template-columns: 1fr 1fr; } }

        .card { background: var(--bg-card); padding: 25px; border: 1px solid var(--border-color); display: flex; flex-direction: column; }
        .card-title { margin-top: 0; margin-bottom: 20px; font-size: 1.1rem; text-transform: uppercase; }

        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .input-group { margin-bottom: 18px; }
        label { display: block; font-size: 0.8rem; color: var(--text-sec); text-transform: uppercase; margin-bottom: 6px; font-weight: bold; }
        
        input, select {
            width: 100%; padding: 12px; background: var(--bg-input);
            border: 1px solid var(--border-color); color: var(--text-pri);
            font-family: inherit; font-size: 1.1rem; box-sizing: border-box;
        }
        
        input:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 5px var(--accent-glow); }

        .btn-action {
            width: 100%; padding: 15px; background: var(--bg-input);
            color: var(--accent); border: 1px solid var(--accent);
            font-weight: bold; text-transform: uppercase; cursor: pointer;
            transition: 0.2s;
            margin-top: auto;
        }
        .btn-action:hover { background: var(--accent); color: #000; }

        /* --- RESULTADOS --- */
        .results-box { margin-top: 20px; padding: 15px; border: 1px dashed var(--accent); background: var(--accent-glow); display: none; }
        .res-label { font-size: 0.8rem; color: var(--text-sec); text-transform: uppercase; }
        .res-val { font-size: 1.8rem; font-weight: bold; color: var(--accent); }
        .status-badge { display: inline-block; padding: 5px 10px; font-size: 0.8rem; font-weight: bold; color: #000; margin-top: 10px; }

        /* --- FAQ Y AUTOR (FOOTER) --- */
        .footer-info { max-width: 1000px; margin: 40px auto; padding-top: 20px; border-top: 1px solid var(--border-color); }
        .faq-item { margin-bottom: 25px; }
        .faq-q { color: var(--accent); font-weight: bold; text-transform: uppercase; font-size: 0.9rem; margin-bottom: 5px; }
        .faq-a { color: var(--text-sec); font-size: 0.85rem; }
        .author-box { margin-top: 40px; font-size: 0.8rem; color: var(--text-sec); border-left: 3px solid var(--accent); padding-left: 15px; }
    </style>
</head>
<body>

    <div class="header-container">
        <div>
            <h1 class="header-title">CellSplit</h1>
            <div class="header-subtitle">HOST CELL LAB TOOLS</div>
        </div>
        
        <div class="controls">
            <div class="lang-switch">
                <span id="lang-es" class="active" onclick="setLanguage('es')">ES</span> | 
                <span id="lang-en" onclick="setLanguage('en')">EN</span>
            </div>
            
            <a href="https://github.com/ebalderasr/CellSplit" target="_blank" class="btn-docs" data-i18n="btnDocs">
                [ Documentación / Repo ]
            </a>

            <button class="btn-clear" onclick="limpiarDatos()" data-i18n="btnClear">[ Limpiar ]</button>
            <button id="install-btn" class="btn-clear" style="display:none;" data-i18n="btnInstall">[ Instalar ]</button>
        </div>
    </div>

    <div class="app-grid">
        <div class="card">
            <h2 class="card-title" data-i18n="card1Title">01. Conteo de células</h2>
            <div class="input-grid">
                <div class="input-group">
                    <label style="color: var(--live-color);" data-i18n="lblLive">Vivas</label>
                    <input type="number" id="inpVivas" placeholder="0">
                </div>
                <div class="input-group">
                    <label style="color: var(--dead-color);" data-i18n="lblDead">Muertas</label>
                    <input type="number" id="inpMuertas" placeholder="0">
                </div>
            </div>
            <div class="input-grid">
                <div class="input-group">
                    <label data-i18n="lblSquares">Cuadrantes</label>
                    <select id="inpCuadrantes"><option value="10">10</option><option value="5">5</option></select>
                </div>
                <div class="input-group">
                    <label data-i18n="lblDilution">Dilución</label>
                    <input type="number" id="inpDilucion" value="2">
                </div>
            </div>
            <button class="btn-action" onclick="ejecutarConteo()" data-i18n="btnCalc1">Analizar Conteo</button>
            
            <div id="boxResConteo" class="results-box">
                <div style="text-align: center; margin-bottom: 10px;">
                    <div data-i18n="resViableConc" class="res-label">Concentración Viable (x10⁶ cell/mL)</div>
                    <div class="res-val" id="outConc">0.00</div>
                </div>
                <div id="outStatus" class="status-badge">Diagnóstico</div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title" data-i18n="card2Title">02. Pase</h2>
            <div class="input-group">
                <label data-i18n="lblCurrentC">Conc. Actual (x10⁶ cell/mL)</label>
                <input type="number" id="inpC1" placeholder="...">
            </div>
            <div class="input-grid">
                <div class="input-group">
                    <label data-i18n="lblTargetV">Vol. Meta (mL)</label>
                    <input type="number" id="inpV2" value="25">
                </div>
                <div class="input-group">
                    <label data-i18n="lblTargetC">Dens. Meta (x10⁶)</label>
                    <input type="number" id="inpC2" value="0.3">
                </div>
            </div>
            <button class="btn-action" onclick="ejecutarInoculo()" data-i18n="btnCalc2">Calcular Pase</button>
            <div id="boxResInoculo" class="results-box">
                <div style="text-align: center;">
                    <div data-i18n="resInoculum" class="res-label">Volumen Inóculo</div>
                    <div class="res-val"><span id="outV1">0.00</span> <span class="u">mL</span></div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer-info">
        <div class="faq-item">
            <div class="faq-q" data-i18n="faqQ">¿Cómo se calcula la concentración?</div>
            <div class="faq-a" data-i18n="faqA">Se asume una cámara de Neubauer de 0.1mm de profundidad. La fórmula es: (Células / Cuadrantes) * Dilución * 10,000.</div>
        </div>
        
        <div class="author-box">
            <strong data-i18n="lblAuthor">Autor: Emiliano Balderas</strong><br>
            <span data-i18n="authorBio">Ingeniero en Biotecnología | Estudiante de Doctorado en Bioquímica, IBt-UNAM</span>
        </div>
    </div>

    <script>
        // --- DICCIONARIO MULTILINGÜE ---
        const i18n = {
            es: {
                btnDocs: "[ Documentación / Repo ]",
                btnClear: "[ Limpiar ]",
                btnInstall: "[ Instalar App ]",
                card1Title: "01. Conteo de células",
                lblLive: "Vivas", lblDead: "Muertas", lblSquares: "Cuadrantes", lblDilution: "Dilución",
                btnCalc1: "Analizar Conteo",
                resViableConc: 'Concentración Viable (x10⁶ <span class="u">cell/mL</span>)',
                card2Title: "02. Pase",
                lblCurrentC: 'Conc. Actual (x10⁶ <span class="u">cell/mL</span>)',
                lblTargetV: 'Vol. Meta (<span class="u">mL</span>)',
                lblTargetC: "Dens. Meta (x10⁶)",
                btnCalc2: "Calcular Pase",
                resInoculum: "Volumen Inóculo",
                alertCells: "Ingresa células válidas.",
                statLow: "⚠️ Conteo bajo", statHigh: "⚠️ Conteo alto", statOpt: "✔️ Rango óptimo",
                faqQ: "¿Cómo se calcula la concentración?",
                faqA: "Se asume una cámara de Neubauer de 0.1mm de profundidad. La fórmula es: (Células / Cuadrantes) * Dilución * 10,000.",
                lblAuthor: "Autor: Emiliano Balderas",
                authorBio: "Ingeniero en Biotecnología | Estudiante de Doctorado en Bioquímica, IBt-UNAM"
            },
            en: {
                btnDocs: "[ Docs / Repo ]",
                btnClear: "[ Clear All ]",
                btnInstall: "[ Install App ]",
                card1Title: "01. Viable Count",
                lblLive: "Live", lblDead: "Dead", lblSquares: "Squares", lblDilution: "Dilution",
                btnCalc1: "Analyze Count",
                resViableConc: 'Viable Conc. (x10⁶ <span class="u">cell/mL</span>)',
                card2Title: "02. Passage",
                lblCurrentC: 'Current Conc. (x10⁶ <span class="u">cell/mL</span>)',
                lblTargetV: 'Target Vol. (<span class="u">mL</span>)',
                lblTargetC: "Target Dens. (x10⁶)",
                btnCalc2: "Calculate Passage",
                resInoculum: "Inoculum Volume",
                alertCells: "Please enter cells.",
                statLow: "⚠️ Low count", statHigh: "⚠️ High count", statOpt: "✔️ Optimal range",
                faqQ: "How is concentration calculated?",
                faqA: "A Neubauer chamber with 0.1mm depth is assumed. The formula is: (Cells / Squares) * Dilution * 10,000.",
                lblAuthor: "Author: Emiliano Balderas",
                authorBio: "Biotechnology Engineer | PhD Student in Biochemistry, IBt-UNAM"
            }
        };

        // --- MANEJO DE IDIOMA ---
        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(i18n[lang][key]) el.innerHTML = i18n[lang][key];
            });
            document.getElementById('lang-es').className = lang === 'es' ? 'active' : '';
            document.getElementById('lang-en').className = lang === 'en' ? 'active' : '';
            
            // Actualizar placeholder del input auto-transferido
            document.getElementById('inpC1').placeholder = lang === 'es' ? "Esperando conteo..." : "Waiting for count...";
        }

        // --- CALCULOS MÓDULO 01 ---
        function ejecutarConteo() {
            let vivas = parseInt(document.getElementById('inpVivas').value) || 0;
            let muertas = parseInt(document.getElementById('inpMuertas').value) || 0;
            let cuadrantes = parseInt(document.getElementById('inpCuadrantes').value);
            let dilucion = parseFloat(document.getElementById('inpDilucion').value) || 1;
            let totales = vivas + muertas;

            if (totales <= 0) return;

            // Fórmula: (Vivas / Cuadrantes) * Dilución * 10,000 / 1,000,000 (para x10^6)
            let conc = (vivas / cuadrantes) * dilucion * 0.01; 
            
            document.getElementById('outConc').innerText = conc.toFixed(2);
            document.getElementById('boxResConteo').style.display = 'block';
            
            // Diagnóstico visual
            let statusBadge = document.getElementById('outStatus');
            let min = cuadrantes === 10 ? 100 : 50;
            let max = cuadrantes === 10 ? 500 : 250;
            
            if (totales < min) { statusBadge.innerText = i18n[currentLang].statLow; statusBadge.style.backgroundColor = "#d4ff00"; }
            else if (totales > max) { statusBadge.innerText = i18n[currentLang].statHigh; statusBadge.style.backgroundColor = "#ef5350"; }
            else { statusBadge.innerText = i18n[currentLang].statOpt; statusBadge.style.backgroundColor = "#4caf50"; }

            // Auto-transferencia
            document.getElementById('inpC1').value = conc.toFixed(2);
        }

        // --- CALCULOS MÓDULO 02 ---
        function ejecutarInoculo() {
            let c1 = parseFloat(document.getElementById('inpC1').value);
            let v2 = parseFloat(document.getElementById('inpV2').value);
            let c2 = parseFloat(document.getElementById('inpC2').value);
            
            if (!c1 || c1 <= c2) return;
            
            let v1 = (c2 * v2) / c1;
            document.getElementById('outV1').innerText = v1.toFixed(3);
            document.getElementById('boxResInoculo').style.display = 'block';
        }

        function limpiarDatos() { location.reload(); }

        // --- PWA LOGIC ---
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-btn').style.display = 'block';
        });

        document.getElementById('install-btn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt = null;
            }
        });

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
        }

        // Inicio por defecto
        setLanguage('es');
    </script>
</body>
</html>